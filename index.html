<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gem Explorer: AI-Powered Product Catalog</title>
  
  <!-- Tailwind CSS for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React libraries for component-based UI -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  
  <!-- Babel to translate JSX in the browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* A simple scrollbar style to make the chat history look cleaner */
    .custom-scrollbar::-webkit-scrollbar {
      width: 8px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f1f5f9; /* slate-100 */
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #94a3b8; /* slate-400 */
      border-radius: 4px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #475569; /* slate-600 */
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
    }
    .animate-fade-in {
        animation: fadeIn 0.2s ease-out forwards;
    }
  </style>
</head>
<body class="bg-slate-100">
  <div id="root"></div>

  <script type="text/babel">
    // --- DATA STRUCTURE (As specified in the prompt) ---
    const PRODUCTS = [
      { id: 1, name: 'Evaluation and Improvement Bot', category: 'Design Analysis', description: 'Converts prototypes into improvement plans with Figma Make prompts', brand: 'Gemini', specs: 'This interactive assistant streamlines your design review by converting prototype videos or screenshots into a direct improvement plan with clear descriptions, severity ratings, and Figma Make prompts', url: 'https://gemini.google.com/gem/1jYmfsrkjVz9XpjUsQazOBGvm6p-DpT79?usp=sharing' },
      { id: 2, name: 'Heuristic Analysis Bot', category: 'Design Analysis', description: 'Generates a comprehensive heuristic evaluation', brand: 'Gemini', specs: 'This bot generates a comprehensive heuristic evaluation by transforming a prototype video into a rigorous, actionable usability audit based on Nielsen\'s principles', url: 'https://gemini.google.com/gem/1lgF3FT1pcVeRjrb_H9TDq6uLgGVUa3T2?usp=sharing' },
      { id: 3, name: 'Insight Collection Space', category: 'Research & Strategy', description: 'Organizes and analyzes research, creating categories and reports', brand: 'Gemini', specs: 'This chatbot helps you organize and analyze your research by guiding you through predefined steps to identify categories, create collections, and generate research findings reports', url: 'https://gemini.google.com/gem/1JQ0ltBsP13oe__uBJJfOVm9V3wWZD4Ni?usp=sharing' },
      { id: 4, name: 'Research Assistant', category: 'Research & Strategy', description: 'Streamlines research workflow and provides recommendations or deliverables', brand: 'Gemini', specs: 'This chatbot streamlines your research workflow by assisting with 14 essential research activities and providing intelligent recommendations or a professional-grade deliverable', url: 'https://www.google.com/search?q=https://gemini.google.com/gem/1Ldq4Y6oM_UN51cKCRGWKzIPvhnTPsDMu%3Fusp%3Dsharing' },
      { id: 5, name: 'The Dynamic Q&A Bot', category: 'Design Generation', description: 'Gathers specific information using concise, dynamic questions', brand: 'Gemini', specs: 'This chatbot uses a fixed set of concise, dynamically determined, short or multiple-choice questions to gather specific information while minimizing user effort', url: 'https://gemini.google.com/gem/1rL-C7pQklAHdDw_O8F8bz1Wvc7FGQ3OF?usp=sharing' },
      { id: 6, name: 'The Wireframe Writer', category: 'Design Generation', description: 'Transforms project briefs into detailed, Figma-ready wireframes', brand: 'Gemini', specs: 'This specialized assistant guides you through a structured and collaborative design process to transform your project brief into a detailed, Figma-ready wireframe', url: 'https://gemini.google.com/gem/1nPo8mI8T1tZfTlCl9W0VV4hxPchebYDT?usp=sharing' }
    ];

    // --- MAIN APPLICATION COMPONENT ---
    function App() {
      // Product and filter state
      const [filteredProducts, setFilteredProducts] = React.useState(PRODUCTS);
      const [activeCategory, setActiveCategory] = React.useState('All');

      // Modal state
      const [isModalOpen, setIsModalOpen] = React.useState(false);
      const [selectedProduct, setSelectedProduct] = React.useState(null);
      const [isSuggestionModalOpen, setIsSuggestionModalOpen] = React.useState(false);

      // AI and Chat state
      const [chatHistory, setChatHistory] = React.useState([
        { role: 'model', parts: [{ text: "Hi! How can I help you find the perfect Gem? Try asking for 'bots that help with usability audits'." }] }
      ]);
      const [userInput, setUserInput] = React.useState('');
      const [isLoading, setIsLoading] = React.useState(false);
      const [summary, setSummary] = React.useState('');
      const [suggestion, setSuggestion] = React.useState(null);
      const [suggestionInput, setSuggestionInput] = React.useState('');

      // Derive unique categories from the product data for the filter buttons
      const categories = ['All', ...new Set(PRODUCTS.map(p => p.category))];
      
      const API_ENDPOINT = '/api/gemini';

      // --- HANDLER FUNCTIONS ---

      const handleCategoryFilter = (category) => {
        setActiveCategory(category);
        if (category === 'All') {
          setFilteredProducts(PRODUCTS);
        } else {
          setFilteredProducts(PRODUCTS.filter(product => product.category === category));
        }
      };

      const openModal = (product) => {
        setSelectedProduct(product);
        setIsModalOpen(true);
        setSummary(''); // Clear previous summary
      };

      const closeModal = () => {
        setIsModalOpen(false);
        setSelectedProduct(null);
      };

      const openSuggestionModal = () => setIsSuggestionModalOpen(true);
      const closeSuggestionModal = () => {
          setIsSuggestionModalOpen(false);
          setSuggestion(null);
          setSuggestionInput('');
      };

      // --- AI FUNCTIONALITY ---

      const handleAISearch = async (e) => {
        e.preventDefault();
        if (!userInput.trim() || isLoading) return;

        setIsLoading(true);
        const userMessage = userInput;
        const newChatHistory = [...chatHistory, { role: 'user', parts: [{ text: userMessage }] }];
        setChatHistory(newChatHistory);
        setUserInput('');

        try {
          const response = await fetch(API_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ type: 'filter', payload: { chatHistory: newChatHistory, userMessage } }),
          });
          if (!response.ok) throw new Error(`API Error: ${response.statusText}`);

          const { aiResponseObject, modelChatMessage } = await response.json();
          const { category, keywords } = aiResponseObject;

          setChatHistory(prev => [...prev, { role: 'model', parts: [{ text: modelChatMessage }] }]);

          const lowercasedKeywords = keywords.map(k => k.toLowerCase());
          const results = PRODUCTS.filter(product => {
            const categoryMatch = product.category.toLowerCase() === category.toLowerCase();
            const textToSearch = `${product.name} ${product.description} ${product.brand} ${product.specs}`.toLowerCase();
            const keywordMatch = lowercasedKeywords.length > 0 && lowercasedKeywords.some(keyword => textToSearch.includes(keyword));
            return categoryMatch || keywordMatch;
          });

          setFilteredProducts(results);
          setActiveCategory(null);

        } catch (error) {
          console.error("AI search failed:", error);
          const errorMessage = "I'm sorry, I'm having trouble connecting. Please try again in a moment.";
          setChatHistory(prev => [...prev, { role: 'model', parts: [{ text: errorMessage }] }]);
        } finally {
          setIsLoading(false);
        }
      };

      const handleSummarize = async () => {
        if (!selectedProduct || isLoading) return;
        setIsLoading(true);
        setSummary('');

        try {
            const response = await fetch(API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ type: 'summarize', payload: { product: selectedProduct } }),
            });
            if (!response.ok) throw new Error(`API Error: ${response.statusText}`);
            const { summary } = await response.json();
            setSummary(summary);
        } catch (error) {
            console.error("Summarize failed:", error);
            setSummary("Sorry, I couldn't generate a summary right now.");
        } finally {
            setIsLoading(false);
        }
      };
      
      const handleSuggest = async (e) => {
        e.preventDefault();
        if (!suggestionInput.trim() || isLoading) return;
        setIsLoading(true);
        setSuggestion(null);

        try {
            const response = await fetch(API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ type: 'suggest', payload: { userInput: suggestionInput } }),
            });
            if (!response.ok) throw new Error(`API Error: ${response.statusText}`);
            const { recommendedProduct } = await response.json();
            setSuggestion(recommendedProduct);
        } catch (error) {
            console.error("Suggestion failed:", error);
            setSuggestion({ error: "Sorry, I couldn't find a suggestion. Please try a different query." });
        } finally {
            setIsLoading(false);
        }
      };

      // --- UI COMPONENTS ---
      const ProductCard = ({ product }) => (
        <div
          onClick={() => openModal(product)}
          className="bg-white rounded-lg p-4 flex flex-col justify-between cursor-pointer shadow-sm hover:shadow-md transition-shadow duration-300 h-[200px]"
        >
          <div>
            <span className="text-xs font-semibold text-emerald-700 uppercase">{product.category}</span>
            <h3 className="text-lg font-bold text-slate-800 mt-1">{product.name}</h3>
          </div>
          <p className="text-slate-600 text-sm leading-snug">{product.description}</p>
        </div>
      );

      const QuickViewModal = () => {
        if (!isModalOpen || !selectedProduct) return null;

        return (
          <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 animate-fade-in" onClick={closeModal}>
            <div className="bg-white rounded-lg shadow-2xl p-6 w-full max-w-2xl relative" onClick={(e) => e.stopPropagation()}>
              <button onClick={closeModal} className="absolute top-3 right-3 text-slate-500 hover:text-slate-800 text-2xl" aria-label="Close modal">&times;</button>
              <span className="text-sm font-bold text-emerald-700 uppercase">{selectedProduct.category}</span>
              <h2 className="text-3xl font-bold text-slate-900 mt-1">{selectedProduct.name}</h2>
              <p className="text-md text-slate-500 mb-4">by {selectedProduct.brand}</p>
              <div className="border-t border-slate-200 my-4"></div>
              <h4 className="font-semibold text-slate-800 mb-2">Detailed Specs:</h4>
              <p className="text-slate-700 leading-relaxed mb-4">{selectedProduct.specs}</p>

              {/* AI Summary Section */}
              <div className="bg-slate-100 p-4 rounded-lg">
                  <button onClick={handleSummarize} disabled={isLoading} className="flex items-center justify-center w-full font-bold text-emerald-800 disabled:opacity-50 disabled:cursor-wait">
                      <span className="text-xl mr-2">✨</span> Summarize Gem
                  </button>
                  {isLoading && summary === '' && <p className="text-center text-slate-500 mt-2">Generating summary...</p>}
                  {summary && <p className="text-slate-800 mt-3 text-center italic">"{summary}"</p>}
              </div>

              <div className="border-t border-slate-200 my-4"></div>
              <a href={selectedProduct.url} target="_blank" rel="noopener noreferrer" className="inline-block w-full text-center bg-emerald-700 text-white font-bold py-3 px-6 rounded-lg hover:bg-emerald-800 transition-colors duration-300">Go to Gem</a>
            </div>
          </div>
        );
      };
      
      const SuggestionModal = () => {
          if (!isSuggestionModalOpen) return null;

          return (
            <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 animate-fade-in" onClick={closeSuggestionModal}>
              <div className="bg-white rounded-lg shadow-2xl p-6 w-full max-w-2xl relative" onClick={(e) => e.stopPropagation()}>
                <button onClick={closeSuggestionModal} className="absolute top-3 right-3 text-slate-500 hover:text-slate-800 text-2xl" aria-label="Close modal">&times;</button>
                <h2 className="text-2xl font-bold text-slate-900 mb-2">Find the Best Gem for Your Task</h2>
                <p className="text-slate-600 mb-4">Describe what you need to do, and our AI will recommend the perfect Gem.</p>
                <form onSubmit={handleSuggest}>
                  <textarea
                    value={suggestionInput}
                    onChange={(e) => setSuggestionInput(e.target.value)}
                    placeholder="e.g., 'I need to create a detailed wireframe from a project brief' or 'Help me organize my user research notes'"
                    className="w-full h-24 p-2 border border-slate-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500"
                    disabled={isLoading}
                  />
                  <button type="submit" disabled={isLoading || !suggestionInput.trim()} className="mt-2 w-full bg-emerald-700 text-white font-bold py-2 px-4 rounded-md disabled:bg-slate-400 hover:bg-emerald-800 transition-colors">
                    {isLoading ? "Thinking..." : "✨ Suggest a Gem"}
                  </button>
                </form>
                {suggestion && (
                  <div className="mt-4 border-t pt-4">
                    {suggestion.error ? (
                        <p className="text-red-600">{suggestion.error}</p>
                    ) : (
                        <div>
                            <h3 className="font-bold text-lg">We recommend:</h3>
                            <div className="mt-2 bg-emerald-50 border border-emerald-200 p-4 rounded-lg cursor-pointer hover:bg-emerald-100" onClick={() => { openModal(suggestion); closeSuggestionModal(); }}>
                                <h4 className="font-bold text-emerald-800">{suggestion.name}</h4>
                                <p className="text-sm text-slate-700">{suggestion.description}</p>
                            </div>
                        </div>
                    )}
                  </div>
                )}
              </div>
            </div>
          );
      };

      // --- RENDER ---
      return (
        <div className="bg-slate-100 min-h-screen font-sans text-slate-800">
          <header className="bg-white shadow-md sticky top-0 z-10">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
              <h1 className="text-3xl font-bold text-slate-900 py-4">Gem explorer.</h1>
              <button onClick={openSuggestionModal} className="bg-emerald-100 text-emerald-800 font-bold py-2 px-4 rounded-full hover:bg-emerald-200 transition-colors text-sm">
                ✨ Suggest a Gem for Me
              </button>
            </div>
          </header>

          <main className="max-w-7xl mx-auto p-4 lg:p-8">
            <div className="flex flex-col lg:flex-row lg:space-x-8">
              <div className="lg:w-1/3 mb-8 lg:mb-0">
                <div className="bg-white rounded-lg shadow-sm p-4 h-full flex flex-col">
                  <h2 className="text-xl font-bold mb-4 border-b pb-2">AI Filter Assistant</h2>
                  <div className="flex-grow overflow-y-auto h-96 pr-2 mb-4 custom-scrollbar">
                    {chatHistory.map((msg, index) => (
                      <div key={index} className={`mb-3 p-3 rounded-lg max-w-xs ${msg.role === 'user' ? 'bg-emerald-100 ml-auto' : 'bg-slate-200 mr-auto'}`}>
                        <p className="text-sm">{msg.parts[0].text}</p>
                      </div>
                    ))}
                  </div>
                  <form onSubmit={handleAISearch} className="flex items-center space-x-2">
                    <input
                      type="text"
                      value={userInput}
                      onChange={(e) => setUserInput(e.target.value)}
                      placeholder={isLoading ? "Thinking..." : "Ask to find Gems..."}
                      className="w-full border-slate-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500"
                      disabled={isLoading}
                    />
                    <button type="submit" disabled={isLoading || !userInput.trim()} className="bg-emerald-700 text-white px-4 py-2 rounded-md font-semibold disabled:bg-slate-400 disabled:cursor-not-allowed hover:bg-emerald-800 transition-colors">Send</button>
                  </form>
                </div>
              </div>

              <div className="lg:w-2/3">
                <div className="flex flex-wrap gap-2 mb-6">
                  {categories.map(category => (
                    <button
                      key={category}
                      onClick={() => handleCategoryFilter(category)}
                      className={`px-4 py-2 text-sm font-medium rounded-full transition-colors duration-200 ${activeCategory === category ? 'bg-emerald-700 text-white shadow' : 'bg-white text-slate-700 hover:bg-slate-200'}`}
                    >
                      {category}
                    </button>
                  ))}
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                  {filteredProducts.length > 0 ? (
                    filteredProducts.map(product => <ProductCard key={product.id} product={product} />)
                  ) : (
                    <div className="md:col-span-2 xl:col-span-3 text-center py-12 bg-white rounded-lg">
                      <h3 className="text-xl font-semibold">No Gems Found</h3>
                      <p className="text-slate-500 mt-2">Try a different AI query or select another category.</p>
                    </div>
                  )}
                </div>
              </div>
            </div>
          </main>
          <QuickViewModal />
          <SuggestionModal />
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>

